{"name":"Chef Varnish","tagline":"Chef Cookbook to Install/Manage Varnish","body":"varnish_ng Cookbook\r\n=============\r\n\r\n[![Build Status](https://travis-ci.org/vkhatri/chef-varnish-ng.svg?branch=master)](https://travis-ci.org/vkhatri/chef-varnish-ng)\r\n\r\nThis is a [Chef] cookbook to manage [Varnish] using LWRP.\r\n\r\nTraditionally, system runs a single Varnish service with multiple instances and multiple vhost.\r\n\r\nThis cookbook provide even more flexibility and ease of management to Varnish, by setting up multiple varnish services separated from each other.\r\n\r\nAll the funcationality of a single varnish service remains the same for each LWRP resources created varnish service.\r\n\r\nEach varnish service created by LWRP is a separate varnish service (instance) running with its own unique configuration.\r\n\r\n\r\nMore features and attributes will be added over time, **feel free to contribute**\r\nwhat you find missing!\r\n\r\n\r\n## Repository\r\n\r\nhttps://github.com/vkhatri/chef-varnish-ng\r\n\r\n\r\n## Supported Platforms\r\n\r\nThis cookbook was tested on Ubuntu 14.04 and Amazon 2014-09 AMI. This cookbook is expected to work for CentOS, RedHat & Fedora, but not yet tested.\r\n\r\n\r\n## Supported Varnish Version\r\n\r\nThis cookbook was tested for Varnish version 4.0. This cookbook is expected to work with  Varnish version 3.0, but not yet tested.\r\n\r\n## Supported Install Types\r\n\r\nCurrently Varnish installation is supported **ONLY** via Repository Packages.\r\n\r\n\r\n## Recipes\r\n\r\n- `varnish::default` - recipe to install and configure varnish\r\n- `varnish::install` - recipe to install varnish\r\n- `varnish::config` - recipe to configure basic varnish directories/files and disable default\r\n- `varnish::instance` - recipe to create a dummy LWRP resource, e.g. for vagrant testing\r\n\r\n\r\n## Default varnish* Service\r\n\r\nBy default, recipe `vanrish_ng::config` disables default varnish service which can be controlled by node attribute `node['varnish']['disable_default']`.\r\n\r\nInstead of managing default varnish configuration & service, this cookbook can manage more than one varnish service as a separate instance. Hence, default varnish service is disabled by default.\r\n\r\n>> This cookbook does not manage default varnish configuration and service, it can only makes sure that default `varnish*` service are not running. Default `varnish*` service management is not in the scope of this cookbook.\r\n\r\n\r\n## Custom Varnish Reload Script\r\n\r\nThis cookbook creates a custom varnish service reload script to reload varnish service for a given instance sysconf file.\r\n\r\nScript location - `node['varnish']['varnish_reload_exec']`\r\n\r\n\r\n## LWRP - Varnish Instance\r\n\r\nRecipe `default` installs required varnish packages and configures common log, storage and other directories/files common for LWRP varnish resources.\r\n\r\n\r\nThis cookbook utilizes the main feature of varnish so caled - instance. For each LWRP resource  this cookbook creates a separate unique varnish `service` as an instance.\r\n\r\nEach LWRP resource is a different varnish service and created with `-n INSTANCE` where LWRP resource name is varnish instance name passed to each LWRP resource service.\r\n\r\nOne can create multiple varnish services / instances using default LWRP. Each LWRP created resource service has its own congiguration, storage directory etc.\r\n\r\nAll LWRP resources shares a commong storage directory location and log directory location, but as each has its own instance name - all LWRP resources service are separated & not related to each other.\r\n\r\n\r\n**LWRP Instance VCL File examples**\r\n\r\n\tvarnish_ng 'varnish instance name' do\r\n\t  notify_restart true\r\n\t  enable_varnishlog false\r\n\t  enable_varnishncsa true\r\n\t  listen_port 80\r\n\t  vcl_conf_cookbook 'varnish_wrapper'\r\n\t  vcl_conf_file 'default.vcl'\r\n\t  service_supports :restart => true, :start => true, :stop => true, :reload => true\r\n\t  admin_listen_port 81\r\n\t  options :tcp_keepalive_time => 3600\r\n\tend\r\n\r\n\r\n**LWRP Instance VCL Template examples**\r\n\r\n\tvarnish_ng 'varnish instance name' do\r\n\t  notify_restart true\r\n\t  enable_varnishlog false\r\n\t  enable_varnishncsa true\r\n\t  listen_port 80\r\n\t  vcl_conf_cookbook 'varnish_wrapper'\r\n\t  vcl_conf_template 'default.vcl.erb'\r\n\t  vcl_conf_template_attrs :param => value # if any\r\n\t  service_supports :restart => true, :start => true, :stop => true, :reload => true\r\n\t  admin_listen_port 81\r\n\t  options :tcp_keepalive_time => 3600\r\n\tend\r\n\r\n\r\n**LWRP Resource attributes**\r\n\r\nParameters:\r\n\r\n- *action (optional)*         - default :create, options: :create, :delete\r\n- *enable_varnishlog (optional, TrueClass/FalseClass)* - enable/disable varnishlog service\r\n- *enable_varnishncsa (optional, TrueClass/FalseClass)* - enable/disable varnishncsa service\r\n- *varnishncsa_format (optional, String)* - varnishncsa log format\r\n- *service_supports (optional, Hash)*  - varnish* services chef service resource attribute `supports`\r\n- *service_action (optional, Array)*  - varnish* services chef service resource attribute `action`\r\n- *notify_restart (optional, TrueClass/FalseClass)* - notifies varnish* service on config resource update\r\n- *start (optional, TrueClass/FalseClass)* - whether to start varnish service, for debian platform_family\r\n- *storage_type (optional, String)* - varnish storage type, options: memory, file\r\n- *storage_size (optional, String)* - varnish storage size\r\n- *listen_address (optional, String)* - varnish listen address\r\n- *listen_port (required, String/Integer)* - varnish listen port\r\n- *admin_listen_address (optional, String)* - varnish admin listen address\r\n- *admin_listen_port (optional, String/Integer)* - varnish admin listen port\r\n- *nfiles (optional, String/Integer)* - varnish service ulimit attribute nfiles\r\n- *memlock (optional, String/Integer)* - varnish service ulimit attribute memlock\r\n- *nprocs (optional, String/Integer)* - varnish service ulimit attribute nprocs\r\n- *corefile (optional, String/Integer)* - varnish service ulimit attribute corefile\r\n- *reload_vcl (optional, String/Integer)* - varnish init service attribute\r\n- *ttl (optional, String/Integer)* - varnish parameter ttl\r\n- *options (optional, Hash)* - varnish extra service parameter key/value pair\r\n- *vcl_conf_cookbook (optional, String)* - varnish vcl conf cookbook name\r\n- *vcl_conf_file (optional, String)* - varnish vcl conf file name\r\n- *vcl_conf_template (optional, String)* - varnish vcl conf template name\r\n- *vcl_conf_template_attrs (optional, Hash)* - varnish vcl conf template attribute if any\r\n\r\n\r\n## Cookbook Core Attributes\r\n\r\n * `default['varnish']['manage']` (default: `version`): varnish package repository version\r\n\r\n * `default['varnish']['user']` (default: `varnish`): varnish user\r\n\r\n * `default['varnish']['group']` (default: `varnish`): varnish group\r\n\r\n * `default['varnish']['log_user']` (default: `calculated`): varnish log service user\r\n\r\n * `default['varnish']['log_group']` (default: `calculated`): varnish log service group\r\n\r\n * `default['varnish']['conf_dir']` (default: `/etc/varnish`): varnish configuration directory\r\n\r\n * `default['varnish']['sysconf_dir']` (default: `calculated`): varnish service sysconf directory\r\n\r\n * `default['varnish']['log_dir']` (default: `/var/log/varnish`): varnish log directory\r\n\r\n * `default['varnish']['storage_dir']` (default: `/var/lib/varnish`): varnish storage directory\r\n\r\n * `default['varnish']['manage_secret']` (default: `false`): whether to manage varnish secret file content\r\n\r\n * `default['varnish']['secret']` (default: `nil`): varnish secret file content\r\n\r\n * `default['varnish']['secret_file']` (default: `/etc/varnish/secret`): varnish secret file\r\n\r\n * `default['varnish']['disable_default']` (default: `true`): disable varnish default service\r\n\r\n * `default['varnish']['varnish_reload_exec']` (default: `calculated`): varnish init service reload shell script location\r\n\r\n\r\n## Cookbook Repository Attributes\r\n\r\n * `default['varnish']['yum']['enable']` (default: `true`): varnish repo yum attribute\r\n\r\n * `default['varnish']['yum']['description']` (default: `varnish cache`): varnish repo yum attribute\r\n\r\n * `default['varnish']['yum']['gpgcheck']` (default: `true`): varnish repo yum attribute\r\n\r\n * `default['varnish']['yum']['gpgkey']` (default: `â€¦`): varnish repo yum attribute\r\n\r\n * `default['varnish']['yum']['action']` (default: `:create`): varnish repo yum attribute\r\n\r\n * `default['varnish']['apt']['uri']` (default: `...`): varnish repo apt attribute\r\n\r\n * `default['varnish']['apt']['enable']` (default: `true`): varnish repo apt attribute\r\n\r\n * `default['varnish']['apt']['distribution']` (default: `calculated`): varnish repo apt attribute\r\n\r\n * `default['varnish']['apt']['components']` (default: `calculated`): varnish repo apt attribute\r\n\r\n * `default['varnish']['apt']['keyserver']` (default: `keyserver.ubuntu.com`): varnish repo apt attribute\r\n\r\n * `default['varnish']['apt']['key']` (default: `C4DEFFEB`): varnish4 repo apt attribute\r\n\r\n * `default['varnish']['apt']['deb_src']` (default: `true`): varnish repo apt attribute\r\n\r\n * `default['varnish']['apt']['action']` (default: `:add`): varnish repo apt attribute\r\n\r\n\r\n## Cookbook LWRP Resource Default Attributes\r\n\r\n* `default['varnish']['instance']['enable_varnishlog']` (default: `false`): whether to setup varnishlog service\r\n\r\n* `default['varnish']['instance']['enable_varnishncsa']` (default: `true`): whether to setup varnishncsa service\r\n\r\n* `default['varnish']['instance']['ncsa_log_format']` (default: `...`): varnishncsa service log format\r\n\r\n* `default['varnish']['instance']['service_supports']` (default: `nil`): varnish service `supports` attribute\r\n\r\n* `default['varnish']['instance']['service_action']` (default: `[:start, :enable]`): varnish service `action` attribute\r\n\r\n* `default['varnish']['instance']['notify_restart']` (default: `true`): whether to notify varnish service on resource update\r\n\r\n* `default['varnish']['instance']['storage_type']` (default: `file`): varnish service storage type\r\n\r\n* `default['varnish']['instance']['storage_size']` (default: `1G`): varnish service storage size\r\n\r\n* `default['varnish']['instance']['nfiles']` (default: `131072`): varnish service parameter `nfiles`, LWRP default value\r\n\r\n* `default['varnish']['instance']['memlock']` (default: `82000`): varnish service parameter `memlock`, LWRP default value\r\n\r\n* `default['varnish']['instance']['nprocs']` (default: `unlimited`): varnish service parameter `nprocs`, LWRP default value\r\n\r\n* `default['varnish']['instance']['corefile']` (default: `unlimited`): varnish service parameter `corefile`, LWRP default value\r\n\r\n* `default['varnish']['instance']['reload_vcl']` (default: `1`): varnish service parameter `reload_vcl`, LWRP default value\r\n\r\n* `default['varnish']['instance']['ttl']` (default: `3600`): varnish service parameter `ttl`, LWRP default value\r\n\r\n* `default['varnish']['instance']['options']` (default: `{}`): varnish service `-p ..` parameters\r\n\r\n* `default['varnish']['instance']['vcl_conf_cookbook']` (default: `varnish_ng`): varnish vcl cookbook\r\n\r\n* `default['varnish']['instance']['vcl_conf_file']` (default: `nil`): varnish vcl file, overrides `vcl_conf_template` attribute\r\n\r\n* `default['varnish']['instance']['vcl_conf_template']` (default: `nil`): varnish vcl template\r\n\r\n* `default['varnish']['instance']['vcl_conf_template_attrs']` (default: `{}`): varnish vcl template attributes if any\r\n\r\n* `default['varnish']['instance']['start']` (default: `yes`): varnish init service attribute START for debian platform_family\r\n\r\n\r\n## Contributing\r\n\r\n1. Fork the repository on Github\r\n2. Create a named feature branch (like `add_component_x`)\r\n3. Write your change\r\n4. Write tests for your change (if applicable)\r\n5. Run the tests (`rake`), ensuring they all pass\r\n6. Write new resource/attribute description to `README.md`\r\n7. Write description about changes to PR\r\n8. Submit a Pull Request using Github\r\n\r\n\r\n## Copyright & License\r\n\r\nAuthors:: Virender Khatri and [Contributors]\r\n\r\n<pre>\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n</pre>\r\n\r\n\r\n[varnish]: https://www.varnish-cache.org/\r\n[Chef]: https://www.chef.io/\r\n[Contributors]: https://github.com/vkhatri/chef-varnish-ng/graphs/contributors\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}